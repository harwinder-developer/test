/*!  1.6.6 2018-09-17 16:19 */
CHARITABLE=window.CHARITABLE||{},function(a,b){var c=function(b){var c=this,d=b.data("params"),e=new plupload.Uploader(d);this.$dragdrop=b,this.$dropzone=a(e.settings.drop_element),this.$images=a("#"+b.data("images")),this.$loader=this.$dragdrop.find(".charitable-drag-drop-image-loader").first(),this.max_file_uploads=d.multipart_params.max_uploads,this.max_file_size=parseInt(this.$dragdrop.data("max-size"),10),this.uploaded=this.$images.children().length,this.max_uploads_alert_shown=!1,this.max_upload_size_alert_shown=!1,e.init(),e.bind("Init",function(a){c.Init(a)}),e.bind("PostInit",function(a){a.refresh()}),e.bind("FileFiltered",function(a,b){c.FileFiltered(a,b)}),e.bind("FilesAdded",function(a,b){c.FilesAdded(a,b)}),e.bind("Error",function(a,b){console.log(b)}),e.bind("FileUploaded",function(a,b,d){c.FileUploaded(a,b,d)})};c.prototype.Init=function(b){var c=this;this.$dropzone&&(b.features.dragdrop&&!this.$dragdrop.parent().hasClass("mobile")&&(this.$dragdrop.parent().addClass("supports-drag-drop"),this.$dropzone.bind("dragover",function(){c.$dropzone.addClass("drag-over")}),this.$dropzone.bind("dragleave",function(){c.$dropzone.removeClass("drag-over")})),this.$dragdrop.on("click",".remove-image",function(d){return d.preventDefault(),c.remove_image(a(this),b)}))},c.prototype.FileFiltered=function(a,b){var c=this.max_file_uploads&&this.uploaded>=this.max_file_uploads;return c?(this.max_uploads_alert_shown||alert(this.get_max_uploads_message()),this.max_uploads_alert_shown=!0,a.removeFile(b)):b.size>=this.max_file_size?(this.max_upload_size_alert_shown||alert(b,CHARITABLE_UPLOAD_VARS.max_file_size.replace("%1$s",b.name).replace("%2$s",this.bytes_to_mb(this.max_file_size))),this.max_upload_size_alert_shown=!0,a.removeFile(b)):(this.uploaded+=1,this.uploaded===this.max_file_uploads&&this.hide_dropzone(),void this.add_image_loader(b))},c.prototype.FilesAdded=function(a,b){this.$dropzone.removeClass("drag-over"),this.max_uploads_alert_shown=!1,this.max_upload_size_alert_shown=!1,a.refresh(),a.start()},c.prototype.FileUploaded=function(b,c,d){return d=a.parseJSON(d.response),d.success?(this.hide_image_loader(c),void this.$images.append(d.data)):void this.add_image_error(c,CHARITABLE_UPLOAD_VARS.upload_problem.replace("%s",c.name))},c.prototype.get_max_uploads_message=function(){var a=this.max_file_uploads>1?CHARITABLE_UPLOAD_VARS.max_file_uploads_plural:CHARITABLE_UPLOAD_VARS.max_file_uploads_single;return a.replace("%d",this.max_file_uploads)},c.prototype.add_image_loader=function(a){this.$loader.fadeIn(300),this.$loader.children(".images").append('<li data-file-id="'+a.id+'" class="">'+a.name+"</li>")},c.prototype.hide_image_loader=function(a){this.$loader.find("[data-file-id="+a.id+"]").remove(),this.$loader.find(".images li").length||this.$loader.hide()},c.prototype.remove_image=function(a,b){var c=a.parent();return c.fadeOut(300,function(){this.remove()}),this.$dropzone.fadeIn(300),this.uploaded-=1,b.refresh(),!1},c.prototype.hide_dropzone=function(){this.$dropzone.removeClass("drag-over"),this.$dropzone.hide()},c.prototype.bytes_to_mb=function(a){var b=Math.floor(Math.log(a)/Math.log(1024));return 1*(a/Math.pow(1024,b)).toFixed(2)+" "+["B","kB","MB","GB","TB"][b]},c.prototype.add_image_error=function(a,b){var c=this;c.$dropzone.fadeIn(300),c.$loader.find("[data-file-id="+a.id+"]").addClass("error").text(b).delay(5e3).fadeOut(300,function(){c.hide_image_loader(a)})},b.Uploader=c,a(document).ready(function(){a(".charitable-drag-drop").each(function(){new c(a(this))})})}(jQuery,CHARITABLE);